import cv2
import time

def test_camera():
    cap = cv2.VideoCapture(0)

    if not cap.isOpened():
        raise Exception("Could not open webcam")

    # Force high resolution (Full HD)
    cap.set(cv2.CAP_PROP_FRAME_WIDTH, 1920)
    cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 1080)

    # Adjust camera settings
    time.sleep(2)  # Warm-up time
    cap.set(cv2.CAP_PROP_BRIGHTNESS, 0.5)    # 0.0 to 1.0 (mid-level brightness)
    cap.set(cv2.CAP_PROP_CONTRAST, 0.5)      # 0.0 to 1.0 (mid-level contrast)
    cap.set(cv2.CAP_PROP_SATURATION, 0.5)    # 0.0 to 1.0 (mid-level saturation)
    cap.set(cv2.CAP_PROP_AUTO_EXPOSURE, 1)   # 1 = enable, 0 = disable (some cameras only)

    # Optional: try setting focus manually if camera supports it
    # cap.set(cv2.CAP_PROP_FOCUS, 0)          # 0 = infinity, 255 = closest
    # Note: most cheap webcams don't allow manual focus by software.

    print("Press SPACE to capture an image. Press ESC to exit.")

    while True:
        ret, frame = cap.read()
        if not ret:
            print("Failed to grab frame")
            break

        # Show live video
        cv2.imshow("Camera Test - Press SPACE to Capture", frame)

        key = cv2.waitKey(1) & 0xFF

        if key == 27:  # ESC key
            print("Exiting...")
            break
        elif key == 32:  # SPACE key
            filename = f"coin_capture_{int(time.time())}.jpg"
            cv2.imwrite(filename, frame, [cv2.IMWRITE_JPEG_QUALITY, 100])
            print(f"Image saved: {filename}")

    cap.release()
    cv2.destroyAllWindows()

if __name__ == "__main__":
    test_camera()
